<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LoveNote AI Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabaseClient.js"></script>
<style>
:root {
  --pink-start:#ff2f92;
  --pink-end:#ff72c4;
}
* { box-sizing:border-box; }
body {
  margin:0;
  font-family:'Poppins',system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:#ffffff;
}
.wrapper {
  max-width:1100px;
  margin:0 auto;
  padding:18px 16px 40px;
}
.top-bar {
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:18px;
}
.app-title {
  font-weight:800;
  font-size:20px;
  color:#ff2f92;
}
.badge-mode {
  padding:6px 14px;
  border-radius:999px;
  background:#ff2f92;
  color:#fff;
  font-size:12px;
  font-weight:600;
}
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:20px;
}
.card {
  background:linear-gradient(145deg,#ffeef9,#ffffff);
  border-radius:26px;
  padding:18px 18px 20px;
  box-shadow:0 16px 40px rgba(255,0,150,.16);
  border:2px solid rgba(255,150,210,.45);
}
.card-header {
  font-size:16px;
  font-weight:800;
  color:#ff2f92;
  margin-bottom:10px;
}
.card-art {
  width:100%;
  height:120px;
  border-radius:22px;
  margin-bottom:12px;
  background-image:url("img/lovenote-characters-4.png");
  background-size:200% 200%;
  background-repeat:no-repeat;
}
.art1 { background-position:left top; }
.art2 { background-position:right top; }
.art3 { background-position:left bottom; }
.art4 { background-position:right bottom; }

.field-label {
  font-size:12px;
  font-weight:600;
  color:#ff2f92;
  margin-bottom:4px;
}
.input, .select, .textarea, .file-input {
  width:100%;
  border-radius:14px;
  border:1px solid #ffd3ea;
  padding:9px 11px;
  font-size:13px;
  margin-bottom:8px;
  background:#ffffff;
}
.textarea { min-height:60px; resize:vertical; }
.file-input { padding:7px 11px; }

.btn-primary, .btn-secondary {
  width:100%;
  border:none;
  border-radius:18px;
  padding:11px 0;
  margin-top:6px;
  font-size:14px;
  font-weight:700;
  color:#ffffff;
  cursor:pointer;
}
.btn-primary {
  background:linear-gradient(90deg,var(--pink-start),var(--pink-end));
  box-shadow:0 10px 20px rgba(255,0,140,.32);
}
.btn-secondary {
  background:linear-gradient(90deg,#ff9ad8,#ffc3ec);
}
.preview {
  margin-top:4px;
  font-size:11px;
  color:#c96ba5;
}
.preview canvas,
.preview img {
  width:100%;
  border-radius:12px;
}
.output {
  margin-top:6px;
  padding:8px 10px;
  font-size:12px;
  background:#fff;
  border-radius:12px;
  border:1px dashed #ffd3ea;
  min-height:40px;
}

/* Small note under grid */
.helper {
  margin-top:16px;
  font-size:11px;
  color:#999;
  text-align:center;
}
</style>
</head>
<body>
<div class="wrapper">
  <div class="top-bar">
    <div class="app-title">LoveNote AI Studio</div>
    <div class="badge-mode">Valentine Mode â€“ closes Feb 14</div>
  </div>

  <div class="grid">
    <!-- CARD 1 â€“ AI MESSAGE -->
    <div class="card">
      <div class="card-header">*AI Message Generator</div>
      <div class="card-art art1"></div>

      <div class="field-label">Recipient's Name</div>
      <input class="input" id="msgName" placeholder="Emma" />

      <div class="field-label">Type of Message</div>
      <select class="select" id="msgTone">
        <option value="romantic">Romantic</option>
        <option value="cute">Cute</option>
        <option value="funny">Funny</option>
        <option value="apology">Soft Apology</option>
      </select>

      <div class="field-label">Optional: Upload photo</div>
      <input class="file-input" type="file" id="msgUpload" />
      <div class="preview" id="msgPreview">Image preview appears after upload.</div>

      <button class="btn-primary" onclick="generateMessage()">Send Message</button>
      <div class="output" id="msgOutput"></div>
    </div>

    <!-- CARD 2 â€“ MEME CREATOR -->
    <div class="card">
      <div class="card-header">Meme Creator*</div>
      <div class="card-art art2"></div>

      <div class="field-label">Upload Photo</div>
      <input class="file-input" type="file" id="memeUpload" />

      <div class="field-label">Top Text</div>
      <input class="input" id="memeTop" placeholder="When you find your paw-fect match..." />

      <div class="field-label">Bottom Text</div>
      <input class="input" id="memeBottom" placeholder="Bottom caption..." />

      <div class="preview">
        <canvas id="memeCanvas"></canvas>
      </div>

      <button class="btn-primary" onclick="generateMeme()">Generate Meme</button>
      <button class="btn-secondary" onclick="alert('Meme ready to save/share!')">Send Meme</button>
    </div>

    <!-- CARD 3 â€“ GREETING CARD -->
    <div class="card">
      <div class="card-header">*Greeting Card Builder</div>
      <div class="card-art art3"></div>

      <div class="field-label">Recipient's Name</div>
      <input class="input" id="cardName" placeholder="Jessie" />

      <div class="field-label">Card Message</div>
      <textarea class="textarea" id="cardMessage" placeholder="You make my heart skip a beat! â¤ï¸"></textarea>

      <div class="field-label">Upload Card Image</div>
      <input class="file-input" type="file" id="cardUpload" />
      <div class="preview" id="cardPreview">Card preview appears here.</div>

      <button class="btn-primary" onclick="previewCard()">Create Card</button>
      <button class="btn-secondary" onclick="location.href='upsell-card.html'">Open Dancing Card Version</button>
    </div>

    <!-- CARD 4 â€“ PHOTO TRANSFORM -->
    <div class="card">
      <div class="card-header">*Photo Transform</div>
      <div class="card-art art4"></div>

      <div class="field-label">Upload Photo</div>
      <input class="file-input" type="file" id="photoUpload" />

      <div class="field-label">Select Style</div>
      <select class="select" id="photoStyle">
        <option value="dreamy">Dreamy Romantic</option>
        <option value="glow">Pixar Style Glow</option>
        <option value="neon">Neon Love Remix</option>
      </select>

      <div class="preview">
        <img id="photoPreview" alt="preview" style="display:none;" />
      </div>

      <button class="btn-primary" onclick="transformPhoto()">Transform Photo</button>
      <button class="btn-secondary" onclick="alert('Photo ready to save/share!')">Send Photo</button>
    </div>
  </div>

  <div class="helper">
    Tip: To sell access, point Stripe checkout <strong>success URL</strong> to this page (dashboard.html) so only buyers land here.
  </div>
</div>

<script>
const supabase = window.supabaseClient;

// simple preview helper
function attachPreview(inputId, previewId){
  const input = document.getElementById(inputId);
  const preview = document.getElementById(previewId);
  if(!input || !preview) return;
  input.addEventListener("change", e => {
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      preview.innerHTML = '<img src="'+reader.result+'" alt="preview" />';
    };
    reader.readAsDataURL(file);
  });
}

attachPreview("msgUpload","msgPreview");
attachPreview("cardUpload","cardPreview");

// AI Message Generator (template-based)
function generateMessage(){
  const name = document.getElementById("msgName").value || "My Favorite Person";
  const tone = document.getElementById("msgTone").value;
  let msg = "";

  if(tone === "romantic"){
    msg = `Roses are red,\\nViolets are blue,\\nEvery LoveNote I send\\nwill start with you, ${name}. ðŸ’˜`;
  } else if(tone === "cute"){
    msg = `Hey ${name},\\nthis is your official reminder\\nthat you are my favorite notification today. ðŸ’•`;
  } else if(tone === "funny"){
    msg = `${name},\\nI checked my bank account.\\nI can't afford to lose you too. ðŸ˜‚ðŸ’—`;
  } else if(tone === "apology"){
    msg = `${name},\\nI'm sorry I acted like a NPC.\\nCan we restart this level\\nand call it Valentine Mode? ðŸ’ž`;
  }

  document.getElementById("msgOutput").innerText = msg;
}

// Meme Creator with canvas
function generateMeme(){
  const fileInput = document.getElementById("memeUpload");
  const file = fileInput.files[0];
  if(!file){
    alert("Upload a photo first.");
    return;
  }
  const reader = new FileReader();
  reader.onload = function(){
    const img = new Image();
    img.onload = function(){
      const canvas = document.getElementById("memeCanvas");
      const ctx = canvas.getContext("2d");
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img,0,0);

      const top = document.getElementById("memeTop").value;
      const bottom = document.getElementById("memeBottom").value;

      ctx.font = "bold 40px Impact";
      ctx.strokeStyle = "black";
      ctx.lineWidth = 3;
      ctx.fillStyle = "white";
      ctx.textAlign = "center";

      ctx.textBaseline = "top";
      ctx.strokeText(top, canvas.width/2, 10);
      ctx.fillText(top, canvas.width/2, 10);

      ctx.textBaseline = "bottom";
      ctx.strokeText(bottom, canvas.width/2, canvas.height-10);
      ctx.fillText(bottom, canvas.width/2, canvas.height-10);
    };
    img.src = reader.result;
  };
  reader.readAsDataURL(file);
}

// Greeting Card preview (simple)
function previewCard(){
  const name = document.getElementById("cardName").value || "My Favorite Person";
  const msg = document.getElementById("cardMessage").value || "Happy Valentineâ€™s Day!";
  alert("Card created for "+ name + " with message:\\n\\n" + msg);
}

// Photo Transform
function transformPhoto(){
  const fileInput = document.getElementById("photoUpload");
  const file = fileInput.files[0];
  if(!file){
    alert("Upload a photo first.");
    return;
  }
  const style = document.getElementById("photoStyle").value;
  const imgEl = document.getElementById("photoPreview");
  const reader = new FileReader();
  reader.onload = function(){
    imgEl.src = reader.result;
    imgEl.style.display = "block";
    if(style === "dreamy"){
      imgEl.style.filter = "contrast(1.05) saturate(1.2) hue-rotate(-5deg)";
    } else if(style === "glow"){
      imgEl.style.filter = "brightness(1.1) saturate(1.3)";
    } else {
      imgEl.style.filter = "contrast(1.2) saturate(1.4) hue-rotate(20deg)";
    }
  };
  reader.readAsDataURL(file);
}
</script>
</body>
</html>
